
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>iOS9 by Tutorials 学习笔记一：Swift 2.0 | 孟祥月的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    <meta name="baidu-site-verification" content="YSYW9gr1NI" />
    
    <meta name="author" content="孟祥月">
    

    
    <meta name="description" content="Apple在前段时间开源了Swift，在iOS开发领域中又制造了一阵骚动，看了一眼Swift的开发路线图，计划在明年的秋天发布Swift 3.0。Apple现在在Swift上变得也更加的开发，鼓励社区贡献代码，也开始接纳社区的一些反馈了。苹果改变以往的封闭的姿态，表明了它对于Swift语言的重视，同时也说明了Swift语言苹果会加大力度去优化，所以现在对于我们iOS开发人员来说，是时候开始学习iO">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS9 by Tutorials 学习笔记一：Swift 2.0">
<meta property="og:url" content="http://mengxiangyue.com/2015/12/22/iOS9-by-Tutorials-学习笔记一：Swift-2-0/index.html">
<meta property="og:site_name" content="孟祥月的博客">
<meta property="og:description" content="Apple在前段时间开源了Swift，在iOS开发领域中又制造了一阵骚动，看了一眼Swift的开发路线图，计划在明年的秋天发布Swift 3.0。Apple现在在Swift上变得也更加的开发，鼓励社区贡献代码，也开始接纳社区的一些反馈了。苹果改变以往的封闭的姿态，表明了它对于Swift语言的重视，同时也说明了Swift语言苹果会加大力度去优化，所以现在对于我们iOS开发人员来说，是时候开始学习iO">
<meta property="og:updated_time" content="2016-04-25T10:54:34.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS9 by Tutorials 学习笔记一：Swift 2.0">
<meta name="twitter:description" content="Apple在前段时间开源了Swift，在iOS开发领域中又制造了一阵骚动，看了一眼Swift的开发路线图，计划在明年的秋天发布Swift 3.0。Apple现在在Swift上变得也更加的开发，鼓励社区贡献代码，也开始接纳社区的一些反馈了。苹果改变以往的封闭的姿态，表明了它对于Swift语言的重视，同时也说明了Swift语言苹果会加大力度去优化，所以现在对于我们iOS开发人员来说，是时候开始学习iO">

    
    <link rel="alternative" href="/atom.xml" title="孟祥月的博客" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/mengxiangyue.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/mengxiangyue.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="孟祥月的博客" title="孟祥月的博客"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="孟祥月的博客">孟祥月的博客</a></h1>
				<h2 class="blog-motto">昨晚多几分钟的准备，今天少几小时的麻烦。</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					<!-- 
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:mengxiangyue.com">
					</form>
					 -->
					</li>
				</ul>
			</nav>
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody">
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/12/22/iOS9-by-Tutorials-学习笔记一：Swift-2-0/" title="iOS9 by Tutorials 学习笔记一：Swift 2.0" itemprop="url">iOS9 by Tutorials 学习笔记一：Swift 2.0</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="孟祥月" target="_blank" itemprop="author">孟祥月</a>
		
  <p class="article-time">
    <time datetime="2015-12-22T14:15:07.000Z" itemprop="datePublished"> 发表于 2015-12-22</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#控制流"><span class="toc-number">1.</span> <span class="toc-text">控制流</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#repeat…while"><span class="toc-number">1.1.</span> <span class="toc-text">repeat…while</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#guard"><span class="toc-number">1.2.</span> <span class="toc-text">guard</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（相对）完善的错误处理模型"><span class="toc-number">2.</span> <span class="toc-text">（相对）完善的错误处理模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#协议扩展"><span class="toc-number">3.</span> <span class="toc-text">协议扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模式匹配的增强"><span class="toc-number">4.</span> <span class="toc-text">模式匹配的增强</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#API可用性检测"><span class="toc-number">5.</span> <span class="toc-text">API可用性检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#defer关键字"><span class="toc-number">6.</span> <span class="toc-text">defer关键字</span></a></li></ol>
		
		</div>
		
    <blockquote>
      <p>声明：本文章版权归作者所有，转载请注明出处。<br>
        孟祥月的博客：<a href="http://www.mengxiangyue.com" target="_blank" rel="external">http://www.mengxiangyue.com</a><br>
        <a href="http://blog.csdn.net/mengxiangyue" target="_blank" rel="external">http://blog.csdn.net/mengxiangyue</a>
      </p>
    </blockquote>

		<p>Apple在前段时间开源了Swift，在iOS开发领域中又制造了一阵骚动，看了一眼Swift的开发路线图，计划在明年的秋天发布Swift 3.0。Apple现在在Swift上变得也更加的开发，鼓励社区贡献代码，也开始接纳社区的一些反馈了。苹果改变以往的封闭的姿态，表明了它对于Swift语言的重视，同时也说明了Swift语言苹果会加大力度去优化，所以现在对于我们iOS开发人员来说，是时候开始学习iOS了。<br>前段时间也面试了几个人，简历里面好几个都写了精通Swift，但是一问问题好多都答不上来，简历上真的。。。。。更多的人貌似没有开始学Swift，但是最后我都建议他们去学习一下Swift。<br>扯远了，回到正题，这篇文章是我的学习笔记，非本人原创内容，只是在看《iOS 9 by Tutorials》这本书时候的一些笔记，然后加上自己的一些理解而已。    </p>
<p>Swift 2中加入了几个（作者认为）比较重要的改进，如下：</p>
<ul>
<li>新的控制流</li>
<li>（相对）完善的错误处理模型</li>
<li>协议扩展</li>
<li>模式匹配的增强</li>
<li>API可用性检测</li>
<li>其他一些。。。。。。</li>
</ul>
<h3 id="控制流"><a href="#控制流" class="headerlink" title="控制流"></a>控制流</h3><p>在书中首先作者解释了一下控制流，感觉不错：程序中任何能够影响程序执行到不同的路径的结构或者关键字都可以叫做控制流，原文：any construct or keyword that causes the execution of your program to follow a different path can be considered “control flow”.   </p>
<h4 id="repeat…while"><a href="#repeat…while" class="headerlink" title="repeat…while"></a>repeat…while</h4><p>repeat…while是重复的意思，类似于其他语言中的do…while。其实在Swift 1.x中还是使用的do…while，在2.x中为了与do…catch区分，所以改成了repeat，但是语义上还是没有变化。这里多说一句，Swift的好多改进，都是为了让程序读上去更加明确，例如Optional、guard等也有这方面的考虑。   </p>
<blockquote>
<p>本例子中的代码都是在Playground中实现的    </p>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line"><span class="keyword">var</span> x = <span class="number">2</span></span><br><span class="line"><span class="keyword">repeat</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"x:\(x)"</span>)</span><br><span class="line">    x += <span class="number">1</span> <span class="comment">// Swift计划在3.0中移除 ++ -- 所以还是尽量少用吧</span></span><br><span class="line">&#125; <span class="keyword">while</span> x &lt; <span class="number">10</span> <span class="comment">// 这个地方可以添加括号</span></span><br></pre></td></tr></table></figure>
<p>上面while后面可以不适用括号，这个也是Swift的一个改进，Swift中只有必要（即语义不明确）的时候才会要求必须加括号。</p>
<a id="more"></a>
<h4 id="guard"><a href="#guard" class="headerlink" title="guard"></a>guard</h4><p>guard这个词我也不知道怎么翻译，这里就不翻译了。但是这个关键字的作用的就是一个先决条件的检测。先看下面的例子：   </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printName</span><span class="params">(name: String)</span></span> &#123;</span><br><span class="line">    <span class="keyword">guard</span> !name.isEmpty <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"no name"</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">&#125;</span><br><span class="line">printName(<span class="string">""</span>)</span><br><span class="line">printName(<span class="string">"MengXiangYue"</span>)</span><br></pre></td></tr></table></figure>  
<p>上面的例子是一个没有意义的例子，只是为了演示。定义了一个函数打印传入的名字，这个函数的要求如果传入的name为空，就判定程序错误，然后返回不执行代码。<strong>guard</strong> 后面跟一个条件，条件为真的时候不会执行else，当条件为假的时候将会执行else，这样就能够达到了我们的要求。但是可能又回说，我用一个if-else也能够实现这个功能，但是如果要是跟Optional结合在一起就比if-else方便多了，下面继续看这个例子：  </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printName</span><span class="params">(inName: String?)</span></span> &#123; <span class="comment">// 这里变成了可选值了</span></span><br><span class="line">    <span class="keyword">guard</span> <span class="keyword">let</span> name = inName <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"no name"</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">guard</span> !name.isEmpty <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"no name"</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">print</span>(name)</span><br><span class="line">&#125;</span><br><span class="line">printName(<span class="string">""</span>)</span><br><span class="line">printName(<span class="string">"MengXiangYue"</span>)</span><br></pre></td></tr></table></figure>    
<p>上面的例子中传入的参数是一个可选值，这时候使用『guard let name = _name else…』,这个类似于if let解包的方式，但是看下面我们使用guard声明的name变量，在下面是能够正常使用的，但是考虑如果使用if let这个就不能使用了，所以我认为guard结合Optional是使用起来最方便的。另外这个东西也可以实现类似NSAssert类似的功能，只是这个不会崩溃。</p>
<h3 id="（相对）完善的错误处理模型"><a href="#（相对）完善的错误处理模型" class="headerlink" title="（相对）完善的错误处理模型"></a>（相对）完善的错误处理模型</h3><p>这里我加了一个相对，主要是指的相对于Swift 1.x，2.x的错误处理好用了不少，但是相比于java等其他部分语言，还是不完善，Swift中的错误处理，对于抛出错误来说，你只是知道该函数抛出了错误，但是不清楚这个函数抛出了什么错误，书中有句话写的很正确，这个要求写程序的时候一定要在文档中写明，会抛出的各种异常（在java中会明确的抛出Exception，Exception与Swift的Error功能一致）。    </p>
<p>另外相对于Objective-C的NSError把指针传递进去，然后等函数执行完成之后检查，已经先进了不少，鼓掌。。。。。<br>定义下面的一个协议：   </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> swift</span><br><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">JSONParsable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">parse</span><span class="params">(json: [String: AnyObject])</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Self</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>  
<p>这个协议定义了一个静态方法，这里不能叫做类方法，以为协议同时可以应用到Struct上，可以叫类型方法。这个函数使用了<strong>throws</strong> 关键字，这个关键字表示该方法可能会抛出一个错误，这里也看不出来抛出什么错误（你妹啊，啥错误都不知道），所以就更加突出这时候注释的重要性（可以写篇文章：论注释的重要性，哈哈哈）。   </p>
<p>那既然说到抛出错误，那我们就得定义错误，在Swift中定义错误比较容易，只要定义一个枚举类型，然后遵守<strong>ErrorType</strong> 协议就可以了。OC中的NSError同样也实现了<strong>ErrorType</strong> 协议，所以我们能够在OC和Swift中使用NSError没有问题。下面定义一个错误：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">ParseError</span>: <span class="title">ErrorType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">MissingAttribute</span>(message: <span class="type">String</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义一个错误比较简单，跟普通的枚举没什么不同，这里定义了一个有关联值的枚举。关联值这里要多扯一句，关联值这个东西在Swift中能够解决好多与类型相关的东西，有时候我们经常会遇到某个类型与值相关，比如我们自己的工程中，网络请求错误需要带着错误码和错误提示，这时候我在OC中可能需要返回三个参数，但是在Swift中我可以只是返回一个枚举，然后关联上另外的两个值。对于多个有关系的值，同样也可以使用元组，曾经看kingfisher的时候，作者把一个类的配置参数都放到一个元组里面，然后解析这个元组，这样参数可能更加清晰。<br>又扯远了，回到正题。下面我们实现一个结构体Person：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Person</span>: <span class="title">JSONParsable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> firstName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> lastName: <span class="type">String</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">parse</span><span class="params">(json: [String : AnyObject])</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Person</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> firstName = json[<span class="string">"first_name"</span>] <span class="keyword">as</span>? <span class="type">String</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> message = <span class="string">"Expected first_name String"</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="type">ParseError</span>.<span class="type">MissingAttribute</span>(message: message) <span class="comment">// 1</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> lastName = json[<span class="string">"last_name"</span>] <span class="keyword">as</span>? <span class="type">String</span> <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> message = <span class="string">"Expected last_name String"</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="type">ParseError</span>.<span class="type">MissingAttribute</span>(message: message) <span class="comment">// 2</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Person</span>(firstName: firstName, lastName: lastName)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>  
<p>代码比较简单就不过多解释了，就是在不同情况下抛出不同的异常。我们在调用这个方法的时候，需要处理这些异常，这时候就使用到了Swift中的do…catch。下面是代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> person = <span class="keyword">try</span> <span class="type">Person</span>.parse([<span class="string">"foo"</span>: <span class="string">"bar"</span>])</span><br><span class="line">&#125; <span class="keyword">catch</span> <span class="type">ParseError</span>.<span class="type">MissingAttribute</span>(<span class="keyword">let</span> message) &#123;</span><br><span class="line">        <span class="built_in">print</span>(message)</span><br><span class="line">&#125; <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Unexpected ErrorType"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>    
<p>do后面需要使用{}将抛出异常的函数包起来，调用抛出异常的方法的时候，需要使用try关键字，然后后面跟着需要捕获的异常，如果清楚需要捕获的异常的类型，可以再catch后面加上异常类型，如果没有异常类型，那表示捕获所有的异常。异常会按照catch的顺序挨个匹配，直到找到第一个匹配的结束。   </p>
<p>如果我们对于异常不关心，我们可以使用try?、try!调用方法，其中try?调用方法会返回一个Optional值，如果调用成功将会返回对应的结果，如果失败则返回nil，程序一定不会崩溃，但是如果我们直接使用try!如果有异常抛出，程序将会崩溃。所以只有在保证我们调用的函数不会抛出异常的时候才能使用try!。  </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">try</span>? <span class="type">Person</span>.parse([<span class="string">"foo"</span>: <span class="string">"bar"</span>])  <span class="comment">// nil</span></span><br><span class="line"><span class="keyword">let</span> p2 = <span class="keyword">try</span>! <span class="type">Person</span>.parse([<span class="string">"first_name"</span>: <span class="string">"Ray"</span>, <span class="string">"last_name"</span>: <span class="string">"Wenderlich"</span>]) <span class="comment">// Person</span></span><br><span class="line"><span class="keyword">let</span> p3 = <span class="keyword">try</span>! <span class="type">Person</span>.parse([<span class="string">"foo"</span>: <span class="string">"bar"</span>]) <span class="comment">// error crash</span></span><br></pre></td></tr></table></figure>
<h3 id="协议扩展"><a href="#协议扩展" class="headerlink" title="协议扩展"></a>协议扩展</h3><p>在这一部分使用一个例子来介绍协议扩展，协议扩展是在Swift 2.x中一个比较重要的思想。详细的可以看看WWDC 2015 Session 408了解。下面定义一个验证字符串规则的一个协议：  </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">StringValidationRule</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">validate</span><span class="params">(string: String)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Bool</span> <span class="comment">// 验证是否合法的方法</span></span><br><span class="line">    <span class="keyword">var</span> errorType: <span class="type">StringValidationError</span> &#123; <span class="keyword">get</span> &#125;  <span class="comment">// error的类型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>  
<p>上面定义了校验规则的协议，下面定义一个校验器协议：  </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">StringValidator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> validationRules: [<span class="type">StringValidationRule</span>] &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">validate</span><span class="params">(string: String)</span></span> -&gt; (valid: <span class="type">Bool</span>, errors: [<span class="type">StringValidationError</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>   
<p>StringValidator这个校验器，有一个保存校验规则的数组，然后有一个校验方法，返回一个元祖，包含最终的校验结果，及错误。这里我们考虑一下对于校验器可能我们处理的逻辑都是一样的，就是循环所有的校验规则，然后查看是否校验成功。这个逻辑算是比较一致，如果我们把这个放到每个实现该协议的类型里面，那代码可能会重复。这时候我们可以提供一个默认的实现，这就是协议扩展（类似于虚函数的功能）。   </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">StringValidator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">validate</span><span class="params">(string: String)</span></span> -&gt; (valid: <span class="type">Bool</span>, errors:[<span class="type">StringValidationError</span>]) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> errors = [<span class="type">StringValidationError</span>]()</span><br><span class="line">        <span class="keyword">for</span> rule <span class="keyword">in</span> validationRules &#123;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> rule.validate(string)</span><br><span class="line">            &#125; <span class="keyword">catch</span> <span class="keyword">let</span> error <span class="keyword">as</span> <span class="type">StringValidationError</span> &#123;</span><br><span class="line">                errors.append(error)</span><br><span class="line">            &#125; <span class="keyword">catch</span> <span class="keyword">let</span> error &#123;</span><br><span class="line">                <span class="built_in">fatalError</span>(<span class="string">"Unexpected error type: \(error)"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (valid: errors.isEmpty, errors: errors)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面我们实现一个字符串以某些字符开始和以某些字符结束的的规则。首先定义一下上面的StringValidationError<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误类型</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">StringValidationError</span>: <span class="title">ErrorType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="type">MustStartWith</span>(<span class="keyword">set</span>: <span class="type">NSCharacterSet</span>, description: <span class="type">String</span>)</span><br><span class="line">    <span class="keyword">case</span> <span class="type">MustEndWith</span>(<span class="keyword">set</span>: <span class="type">NSCharacterSet</span>, description: <span class="type">String</span>)</span><br><span class="line">    <span class="keyword">var</span> description: <span class="type">String</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> errorString: <span class="type">String</span></span><br><span class="line">      <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</span><br><span class="line">      <span class="keyword">case</span> .<span class="type">MustStartWith</span>(\<span class="number">_</span>, <span class="keyword">let</span> description):</span><br><span class="line">        errorString = <span class="string">"Must start with \(description)."</span></span><br><span class="line">      <span class="keyword">case</span> .<span class="type">MustEndWith</span>(\<span class="number">_</span>, <span class="keyword">let</span> description):</span><br><span class="line">        errorString = <span class="string">"Must end with \(description)."</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> errorString</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br><span class="line"></span><br><span class="line"><span class="comment">// 扩展String</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">startsWithCharacterFromSet</span><span class="params">(<span class="keyword">set</span>: NSCharacterSet)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> !isEmpty <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> rangeOfCharacterFromSet(<span class="keyword">set</span>, options: [], range: startIndex..&lt;startIndex.successor()) != <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">func</span> <span class="title">endsWithCharacterFromSet</span><span class="params">(<span class="keyword">set</span>: NSCharacterSet)</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> !isEmpty <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> rangeOfCharacterFromSet(<span class="keyword">set</span>, options: [], range: endIndex.predecessor()..&lt;endIndex) != <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">StartsWithCharacterStringValidationRule</span> : <span class="title">StringValidationRule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> characterSet: <span class="type">NSCharacterSet</span></span><br><span class="line">    <span class="keyword">let</span> description: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> errorType: <span class="type">StringValidationError</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .<span class="type">MustStartWith</span>(<span class="keyword">set</span>: characterSet, description: description)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">validate</span><span class="params">(string: String)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        string</span><br><span class="line">        <span class="keyword">if</span> string.startsWithCharacterFromSet(characterSet) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> errorType <span class="comment">// 4</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">EndsWithCharacterStringValidationRule</span>: <span class="title">StringValidationRule</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> characterSet: <span class="type">NSCharacterSet</span></span><br><span class="line">    <span class="keyword">let</span> description: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> errorType: <span class="type">StringValidationError</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> .<span class="type">MustEndWith</span>(<span class="keyword">set</span>: characterSet, description: description)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">validate</span><span class="params">(string: String)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> string.endsWithCharacterFromSet(characterSet) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> errorType</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>两个验证规则创建好了，下面我们创建一个校验器：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这个校验器实现了StringValidator，但是由于StringValidator存在扩展，所以可以不用实现该协议中的func validate(string: String) -&gt; (valid: Bool, errors:[StringValidationError])方法</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">StartsAndEndsWithStringValidator</span>: <span class="title">StringValidator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> startsWithSet: <span class="type">NSCharacterSet</span></span><br><span class="line">  <span class="keyword">let</span> startsWithDescription: <span class="type">String</span></span><br><span class="line">  <span class="keyword">let</span> endsWithSet: <span class="type">NSCharacterSet</span></span><br><span class="line">  <span class="keyword">let</span> endsWithDescription: <span class="type">String</span></span><br><span class="line">  <span class="keyword">var</span> validationRules: [<span class="type">StringValidationRule</span>] &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">      <span class="type">StartsWithCharacterStringValidationRule</span>(characterSet: startsWithSet, description: startsWithDescription),</span><br><span class="line">      <span class="type">EndsWithCharacterStringValidationRule</span>(characterSet: endsWithSet, description: endsWithDescription)</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 下面使用一下</span></span><br><span class="line">et numberSet = <span class="type">NSCharacterSet</span>.decimalDigitCharacterSet()</span><br><span class="line"><span class="keyword">let</span> startsAndEndsWithValidator = <span class="type">StartsAndEndsWithStringValidator</span>(startsWithSet: letterSet, startsWithDescription: <span class="string">"letter"</span>, endsWithSet: numberSet, endsWithDescription: <span class="string">"number"</span>)</span><br><span class="line"></span><br><span class="line">startsAndEndsWithValidator.validate(<span class="string">"1foo"</span>).errors.description</span><br></pre></td></tr></table></figure>   </p>
<p>上面的内容是一个简单的例子，我将书中的例子做了一些简化。   </p>
<p>下面我们再看一个例子，在扩展协议的时候我们可以结合where关键字，使符合where条件的类型，才会自动的存在默认的协议扩展。<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 扩展了MutableCollectionType协议，这个协议仅对Index为Int类型的实现了MutableCollectionType的类型生效  </span></span><br><span class="line"><span class="comment">// Index是定义在MutableCollectionType的父协议MutableIndexable中的关联类型</span></span><br><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">MutableCollectionType</span> <span class="title">where</span> <span class="title">Index</span> == <span class="title">Int</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 该方法任意的交换集合元素</span></span><br><span class="line">  <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">shuffleInPlace</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="built_in">c</span> = <span class="keyword">self</span>.<span class="built_in">count</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;(<span class="built_in">c</span>-<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> j = <span class="type">Int</span>(arc4random_uniform(<span class="type">UInt32</span>(<span class="built_in">c</span> - i))) + i</span><br><span class="line">      <span class="keyword">guard</span> i != j <span class="keyword">else</span> &#123; <span class="keyword">continue</span> &#125;</span><br><span class="line">      <span class="built_in">swap</span>(&amp;<span class="keyword">self</span>[i], &amp;<span class="keyword">self</span>[j])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> people = [<span class="string">"Chris"</span>, <span class="string">"Ray"</span>, <span class="string">"Sam"</span>, <span class="string">"Jake"</span>, <span class="string">"Charlie"</span>]</span><br><span class="line">people.shuffleInPlace()</span><br></pre></td></tr></table></figure></p>
<h3 id="模式匹配的增强"><a href="#模式匹配的增强" class="headerlink" title="模式匹配的增强"></a>模式匹配的增强</h3><p>在Swift中可以不仅可以再实现协议扩展的时候使用，还可以在for循环，也可以在if-let、switch、if-case的使用，如下例子：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> names = [<span class="string">"Charlie"</span>, <span class="string">"Chris"</span>, <span class="string">"Mic"</span>, <span class="string">"John"</span>, <span class="string">"Craig"</span>, <span class="string">"Felipe"</span>]</span><br><span class="line"><span class="keyword">var</span> namesThatStartWithC = [<span class="type">String</span>]()</span><br><span class="line"><span class="comment">// 将以"C"开头的名字，加入到数组namesThatStartWithC中</span></span><br><span class="line"><span class="keyword">for</span> cName <span class="keyword">in</span> names <span class="keyword">where</span> cName.hasPrefix(<span class="string">"C"</span>) &#123;</span><br><span class="line">  namesThatStartWithC.append(cName)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个Author</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">struct</span> <span class="title">Author</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">let</span> status: <span class="type">Additional_Things_PageSources</span>.<span class="type">AuthorStatus</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">init</span>(name: <span class="type">String</span>, status: <span class="type">Additional_Things_PageSources</span>.<span class="type">AuthorStatus</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> authors = [</span><br><span class="line">  <span class="type">Author</span>(name: <span class="string">"Chris Wagner"</span>, status: .<span class="type">Late</span>(daysLate: <span class="number">5</span>)),</span><br><span class="line">  <span class="type">Author</span>(name: <span class="string">"Charlie Fulton"</span>, status: .<span class="type">Late</span>(daysLate: <span class="number">10</span>)),</span><br><span class="line">  <span class="type">Author</span>(name: <span class="string">"Evan Dekhayser"</span>, status: .<span class="type">OnTime</span>)</span><br><span class="line">]</span><br><span class="line"><span class="keyword">var</span> slapLog = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> author <span class="keyword">in</span> authors &#123;</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">case</span> .<span class="type">Late</span>(<span class="keyword">let</span> daysLate) = author.status <span class="keyword">where</span> daysLate &gt; <span class="number">2</span> &#123;</span><br><span class="line">    slapLog += <span class="string">"Ray slaps \(author.name) around a bit with a large trout \n"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="API可用性检测"><a href="#API可用性检测" class="headerlink" title="API可用性检测"></a>API可用性检测</h3><p>在Swift 2.x中检测某个API是否可用，不用像原来一样判断是否能够响应某个API，直接使用如下代码，使其在该版本系统下生效即可：<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> #available(iOS <span class="number">9.0</span>, \*) &#123;</span><br><span class="line">  <span class="comment">// 调用在iOS 9下才能使用的API</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="defer关键字"><a href="#defer关键字" class="headerlink" title="defer关键字"></a>defer关键字</h3><p>defer在Swift中表示，在方法结束的时候一定会调用的代码。在程序中我们经常将一些内存回收、状态回复等动作放在代码的最后，但是如果在前面代码执行的过程中，发生了异常，那么可能后面的代码就不能执行，造成程序错误。但是使用defer关键字，能够保证不管程序是否正常结束，该代码一定会被执行。   </p>
<p>例如在使用ATM的时候，不管使用的过程中发生了什么异常都必须保证最后必须把银行卡退给用户，这个在这里使用defer关键字就比较合适。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ATM</span> </span>&#123;</span><br><span class="line">  <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">dispenseFunds</span><span class="params">(amount: Float, <span class="keyword">inout</span> account: Account)</span></span> <span class="keyword">throws</span>&#123;</span><br><span class="line">   <span class="keyword">defer</span> &#123;  <span class="comment">// 保证一定能够退卡成功</span></span><br><span class="line">     log += <span class="string">"Card for \(account.name) has been returned to customer.\n"</span></span><br><span class="line">     ejectCard()</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// 其他的逻辑处理</span></span><br><span class="line"> &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">ejectCard</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// physically eject card</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>   
<p>终于是把这篇文章算是写完了，后面的一部分都是一些小的知识点，慢慢积累吧，自己的读书笔记，希望对别人有帮助吧。</p>

	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS-9-by-Tutoials/">iOS 9 by Tutoials</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/iOS-9/">iOS 9</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://mengxiangyue.com/2015/12/22/iOS9-by-Tutorials-学习笔记一：Swift-2-0/" data-title="iOS9 by Tutorials 学习笔记一：Swift 2.0 | 孟祥月的博客" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>


	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/12/23/iOS-NavigationBar手势返回的时候跟随/" title="iOS NavigationBar手势返回的时候跟随">
  <strong>上一篇：</strong><br/>
  <span>
  iOS NavigationBar手势返回的时候跟随</span>
</a>
</div>


<div class="next">
<a href="/2015/12/19/Hexo结合Github-Pages搭建静态博客/"  title="Hexo结合Github Pages搭建静态博客">
 <strong>下一篇：</strong><br/> 
 <span>Hexo结合Github Pages搭建静态博客
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2015/12/22/iOS9-by-Tutorials-学习笔记一：Swift-2-0/" data-title="iOS9 by Tutorials 学习笔记一：Swift 2.0" data-url="http://mengxiangyue.com/2015/12/22/iOS9-by-Tutorials-学习笔记一：Swift-2-0/"></div>
</section>


</div>

      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#控制流"><span class="toc-number">1.</span> <span class="toc-text">控制流</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#repeat…while"><span class="toc-number">1.1.</span> <span class="toc-text">repeat…while</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#guard"><span class="toc-number">1.2.</span> <span class="toc-text">guard</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#（相对）完善的错误处理模型"><span class="toc-number">2.</span> <span class="toc-text">（相对）完善的错误处理模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#协议扩展"><span class="toc-number">3.</span> <span class="toc-text">协议扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模式匹配的增强"><span class="toc-number">4.</span> <span class="toc-text">模式匹配的增强</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#API可用性检测"><span class="toc-number">5.</span> <span class="toc-text">API可用性检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#defer关键字"><span class="toc-number">6.</span> <span class="toc-text">defer关键字</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/React-Native/" title="React Native">React Native<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS-9-by-Tutoials/" title="iOS 9 by Tutoials">iOS 9 by Tutoials<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS-Tips/" title="iOS Tips">iOS Tips<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/工具/" title="工具">工具<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/iOS-9/" title="iOS 9">iOS 9<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/MShare/" title="MShare">MShare<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/React-Native/" title="React Native">React Native<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Github/" title="Github">Github<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Hexo/" title="Hexo">Hexo<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://blog.csdn.net/mengxiangyue" target="_blank" title="My CSDN Blog">My CSDN Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> iOS小菜鸟一枚，在努力的路上前进着 <br/>
			喜欢交朋友、聊与技术有关无关的，可以加我QQ、邮件联系我。QQ&amp;mail：598660766@qq.com</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/1750643861" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="孟祥月">孟祥月</a>
		

		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize();
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
      
    }
  });
});
</script>
<!-- 解决自动生成文章目录序号问题 -->
<script type="text/javascript">
var regex = new RegExp("^\\d+\\.\\d* ");
var tocItemTextArray = $(".toc-article .toc-item .toc-text");
for (var i = 0; i < tocItemTextArray.length; i++) {
  var item = tocItemTextArray[i];
  item.textContent = item.textContent.replace(regex, "");
}
</script>


<script type="text/javascript">
$(document).ready(function(){
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"mengxinagyue"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
});
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
